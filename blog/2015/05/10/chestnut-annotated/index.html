
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Chestnut - Annotated - Zephyrizing</title>
  <meta name="author" content="Geoff Shannon">

  
  <meta name="description" content="A Note about version numbers At the time of this writing, there were several newer versions of many
of the dependencies used in Chestnut. In &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.zephyrizing.net/blog/2015/05/10/chestnut-annotated">
  <link rel="icon" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="/favicon-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/favicon-160x160.png" sizes="160x160">
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content="/mstile-144x144.png">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Zephyrizing" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>

<body   >
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-43671921-1', 'auto');
  ga('send', 'pageview');
</script>

  <header role="banner"><hgroup>
  <h1><a href="/">Zephyrizing</a></h1>
  
    <h2>Thoughts on cast-iron seasoning, programming and everything&#8230;</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.zephyrizing.net" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/about">About</a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/presentations">Presentations</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  

  <header>
    
      <h1 class="entry-title">Chestnut - Annotated</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-05-10T13:34:16-05:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>1:34 pm</span></time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://www.zephyrizing.net">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><h4>A Note about version numbers</h4>

<p>At the time of this writing, there were several newer versions of many
of the dependencies used in Chestnut. In particular, the ClojureScript
core team had fairly recently released a new version with
<a href="https://github.com/clojure/clojurescript/wiki/Running-REPLs">vastly simplified REPL setup requirements</a> which
triggered changes to many of the related ClojureScript tooling
libraries (Piggieback, and Weasel especially). So PLEASE! Use the
latest version of Chestnut, or if you&rsquo;re setting up your own project
then look up the latest versions on <a href="http://clojars.org/">Clojars</a></p>

<h2>On to the Annotating!</h2>

<p>As I wrote <a href="/blog/2015/04/04/shaving-the-clojurescript-yaks/">recently</a>, I recently dove head first into doing web
development with Clojure and Clojurescript. Along the way I learned a
whole heck of a lot about how to actually set up a <a href="http://leiningen.org/">Leiningen</a>
project to support a nice workflow for such a project. However, most
of my new-found knowledge has already been put together into a very
nice package called <a href="https://github.com/plexus/chestnut">Chestnut</a>. However, at first glance
(and second and third glance really) Chestnut projects are complex and
intimidating.</p>

<p>This post is an annotated walkthrough of the configuration that a new
Chestnut comes with. The best way to follow along would be to start
off by running <code>lein new chestnut tour</code> in shell and then exploring
the files as I talk about them.</p>

<!--more-->


<p>Let&rsquo;s start by looking at the base directory.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Directories
</span><span class='line'>- resources
</span><span class='line'>- src
</span><span class='line'>- env
</span><span class='line'>
</span><span class='line'># Files
</span><span class='line'>- LICENSE
</span><span class='line'>- README.md
</span><span class='line'>- code_of_conduct.md
</span><span class='line'>- project.clj
</span><span class='line'>- Procfile
</span><span class='line'>- system.properties</span></code></pre></td></tr></table></div></figure>


<p>If you&rsquo;re familiar with Clojure development at all, this should look
very familiar to you. But there a few unusual things: the <code>Procfile</code>
and <code>system.properties</code> files, and the <code>env</code> folder.  The <code>Procfile</code>
is a file for letting <a href="https://www.heroku.com/">Heroku</a> know how to run your app, and the
contents of it are explained well in the
<a href="">Heroku guide to getting started with Clojure</a>.</p>

<p><a href="https://devcenter.heroku.com/articles/getting-started-with-clojure#define-a-procfile">https://devcenter.heroku.com/articles/getting-started-with-clojure#define-a-procfile</a></p>

<p>If we use the awesome [tree][tree] program to visualize some of these
directories we can see some interesting stuff. First, <code>src</code> looks
pretty standard for Clojure, with the addition of a second tree for
cljs files.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>src
</span><span class='line'>├── clj
</span><span class='line'>│   └── tour
</span><span class='line'>│       └── server.clj
</span><span class='line'>└── cljs
</span><span class='line'>    └── tour
</span><span class='line'>        └── core.cljs</span></code></pre></td></tr></table></div></figure>


<p>The same is true of the <code>test</code> folder. But what&rsquo;s really interesting
is what is in that new <code>env</code> folder.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>env
</span><span class='line'>├── dev
</span><span class='line'>│   ├── clj
</span><span class='line'>│   │   └── tour
</span><span class='line'>│   │       └── dev.clj
</span><span class='line'>│   └── cljs
</span><span class='line'>│       └── tour
</span><span class='line'>│           └── main.cljs
</span><span class='line'>├── prod
</span><span class='line'>│   ├── clj
</span><span class='line'>│   │   └── tour
</span><span class='line'>│   │       └── dev.clj
</span><span class='line'>│   └── cljs
</span><span class='line'>│       └── tour
</span><span class='line'>│           └── main.cljs
</span><span class='line'>└── test
</span><span class='line'>    ├── js
</span><span class='line'>    │   ├── polyfill.js
</span><span class='line'>    │   └── unit-test.js
</span><span class='line'>    └── unit-test.html</span></code></pre></td></tr></table></div></figure>


<p>What we see is that there are three top-level directories underneath
<code>env</code>, and below each of these we see what looks like normal Clojure
and Clojurescript source trees. Veeery, interesting.</p>

<p>Now let&rsquo;s jump and take a look at the <code>project.clj</code>. This is where the
heart of the action is. The first is boring normal project meta-data,
and we&rsquo;re going to skip it. The next section is interesting though.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'>  <span class="ss">:source-paths</span> <span class="p">[</span><span class="s">&quot;src/clj&quot;</span><span class="p">]</span>
</span><span class='line'>  <span class="ss">:repl-options</span> <span class="p">{</span><span class="ss">:timeout</span> <span class="mi">200000</span><span class="p">}</span> <span class="c1">;; Defaults to 30000 (30 seconds)</span>
</span><span class='line'>
</span><span class='line'>  <span class="ss">:test-paths</span> <span class="p">[</span><span class="s">&quot;spec/clj&quot;</span><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>:repl-options</code> is straightforward. It just increases the timeout
when launching a REPL. Presumably this is because Chestnut REPL&rsquo;s are
so filled with awesome that they take longer to load ;) The <code>*-paths</code>
options are simple too.  They just override the default place that
Leiningen looks for Clojure source and test files by default.</p>

<blockquote><p>N.B. The version of Chestnut I generated this with actually has a
bug, since it generated &ldquo;spec/clj&rdquo; as the test path, but no &ldquo;spec&rdquo;
folder.</p></blockquote>

<p>Next come the dependencies and plugins needed by this project.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'>  <span class="ss">:dependencies</span> <span class="p">[[</span><span class="nv">org.clojure/clojure</span> <span class="s">&quot;1.6.0&quot;</span><span class="p">]</span>
</span><span class='line'>                 <span class="p">[</span><span class="nv">org.clojure/clojurescript</span> <span class="s">&quot;0.0-2511&quot;</span> <span class="ss">:scope</span> <span class="s">&quot;provided&quot;</span><span class="p">]</span>
</span><span class='line'>                 <span class="p">[</span><span class="nv">ring</span> <span class="s">&quot;1.3.2&quot;</span><span class="p">]</span>
</span><span class='line'>                 <span class="p">[</span><span class="nv">ring/ring-defaults</span> <span class="s">&quot;0.1.3&quot;</span><span class="p">]</span>
</span><span class='line'>                 <span class="p">[</span><span class="nv">compojure</span> <span class="s">&quot;1.3.1&quot;</span><span class="p">]</span>
</span><span class='line'>                 <span class="p">[</span><span class="nv">enlive</span> <span class="s">&quot;1.1.5&quot;</span><span class="p">]</span>
</span><span class='line'>                 <span class="p">[</span><span class="nv">om</span> <span class="s">&quot;0.8.0-rc1&quot;</span><span class="p">]</span>
</span><span class='line'>                 <span class="p">[</span><span class="nv">environ</span> <span class="s">&quot;1.0.0&quot;</span><span class="p">]]</span>
</span><span class='line'>
</span><span class='line'>  <span class="ss">:plugins</span> <span class="p">[[</span><span class="nv">lein-cljsbuild</span> <span class="s">&quot;1.0.3&quot;</span><span class="p">]</span>
</span><span class='line'>            <span class="p">[</span><span class="nv">lein-environ</span> <span class="s">&quot;1.0.0&quot;</span><span class="p">]]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Clojure and Clojurescript are obviously necessary, and when you&rsquo;re
using Clojurescript with Leiningen, you probably want the
[lein-cljsbuild][cljsbuild] plugin for compiling your
Clojurescript. <a href="https://github.com/ring-clojure/ring#ring">Ring</a> is the standard Clojure web application&rsquo;s
library. <a href="https://github.com/ring-clojure/ring-defaults#ring-defaults">Ring-defaults</a> is a library for providing standard
configurations of <a href="https://github.com/ring-clojure/ring/wiki/Concepts#middleware">Ring middleware</a>.  <a href="https://github.com/weavejester/compojure#compojure">Compojure</a>
is a routing library built on top of Ring.</p>

<p><sub>
I&rsquo;m not quite sure why the Clojurescript dependency is marked as
<code>provided</code>&hellip;
</sub></p>

<p><a href="https://github.com/cgrand/enlive#enlive-">Enlive</a> is a &ldquo;a selector-based (à la CSS) templating library
for Clojure.&rdquo; Very cool stuff, and wildly useful for many other HTML
processing/producing/consuming tasks than just templating.
Unfortunately very under-documented. <a href="https://github.com/omcljs/om#om">Om</a> is the only
Clojurescript specific dependency in the list, but it&rsquo;s a pretty cool
one. It&rsquo;s a Clojurescript interface to Facebook&rsquo;s React.js library.</p>

<p>Finally we have the <a href="https://github.com/weavejester/environ#environ">Environ</a> library, and it&rsquo;s associated
<code>lein-environ</code> plugin. As their README says:</p>

<blockquote><p>Environ is a Clojure library for managing environment settings from
a number of different sources.</p></blockquote>

<p>However, it is also the basis for a lot of the really neat things that
Chestnut does.</p>

<p>Next up, we have some more basic configuration stuff.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'>  <span class="ss">:min-lein-version</span> <span class="s">&quot;2.5.0&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="ss">:uberjar-name</span> <span class="s">&quot;tour.jar&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>These two settings are specifically to help with deployment to Heroku
which looks for the <code>:min-lein-version</code> key to determine what version
of lein to build your app with. Chestnut also changes the uberjar name
so that the Procfile can specify a specific filename. Normally, the
uberjar name is derived from the project name and the current
version. However, this makes it a moving target.  Every time you bump
your version number you would have to update the Procfile to stay in
sync. This way, the uberjar always has one name and the Procfile never
needs to change.</p>

<p>Finally, we have the basic cljs build configuration:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'>  <span class="ss">:cljsbuild</span> <span class="p">{</span><span class="ss">:builds</span> <span class="p">{</span><span class="ss">:app</span> <span class="p">{</span><span class="ss">:source-paths</span> <span class="p">[</span><span class="s">&quot;src/cljs&quot;</span><span class="p">]</span>
</span><span class='line'>                             <span class="ss">:compiler</span> <span class="p">{</span><span class="ss">:output-to</span>     <span class="s">&quot;resources/public/js/app.js&quot;</span>
</span><span class='line'>                                        <span class="ss">:output-dir</span>    <span class="s">&quot;resources/public/js/out&quot;</span>
</span><span class='line'>                                        <span class="ss">:source-map</span>    <span class="s">&quot;resources/public/js/out.js.map&quot;</span>
</span><span class='line'>                                        <span class="ss">:preamble</span>      <span class="p">[</span><span class="s">&quot;react/react.min.js&quot;</span><span class="p">]</span>
</span><span class='line'>                                        <span class="ss">:optimizations</span> <span class="ss">:none</span>
</span><span class='line'>                                        <span class="ss">:pretty-print</span>  <span class="nv">true</span><span class="p">}}}}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is remarkably similar to the configuration from the
<a href="https://github.com/emezeske/lein-cljsbuild/blob/1.0.5/example-projects/none/project.clj">lein-cljsbuild none example project</a>, and a standard
setup to enable source-maps.</p>

<h3>Profiles</h3>

<p>So far, most of what we&rsquo;ve seen is fairly standard
clojure/clojurescript configuration stuff. But one of the things that
makes Chestnut awesome is that it makes really good use of the
Leiningen profiles feature. In particular, it uses profiles to
concisely specify different clojurescript compilation settings and add
dependencies that are only needed for development. If this is the
first time you&rsquo;ve heard about Leiningen profiles, you should probably
go <a href="https://github.com/technomancy/leiningen/blob/master/doc/PROFILES.md#profiles">read about it</a>. The basic summary is this though:</p>

<blockquote><p>You can place any arbitrary key/value pairs supported by defproject
into a given profile and they will be merged into the project map
when that profile is activated.</p></blockquote>

<p>Let&rsquo;s start with the extra <code>:dev</code> setups. It starts off nice and easy
just adding more clojure source and test paths and some extra
development-only dependencies.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'>  <span class="ss">:profiles</span> <span class="p">{</span><span class="ss">:dev</span> <span class="p">{</span><span class="ss">:source-paths</span> <span class="p">[</span><span class="s">&quot;env/dev/clj&quot;</span><span class="p">]</span>
</span><span class='line'>                   <span class="ss">:test-paths</span> <span class="p">[</span><span class="s">&quot;test/clj&quot;</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'>                   <span class="ss">:dependencies</span> <span class="p">[[</span><span class="nv">figwheel</span> <span class="s">&quot;0.2.1-SNAPSHOT&quot;</span><span class="p">]</span>
</span><span class='line'>                                  <span class="p">[</span><span class="nv">figwheel-sidecar</span> <span class="s">&quot;0.2.1-SNAPSHOT&quot;</span><span class="p">]</span>
</span><span class='line'>                                  <span class="p">[</span><span class="nv">com.cemerick/piggieback</span> <span class="s">&quot;0.1.3&quot;</span><span class="p">]</span>
</span><span class='line'>                                  <span class="p">[</span><span class="nv">weasel</span> <span class="s">&quot;0.4.2&quot;</span><span class="p">]]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Notice that there is a similar entry under the <code>:uberjar</code> profile for
<code>:source-paths</code> but that the <code>:test-paths</code> are omitted (since the
uberjar is typically for distributing production code).</p>

<p><a href="https://github.com/bhauman/lein-figwheel#lein-figwheel">Figwheel</a> is a very cool project that &ldquo;pushes ClojureScript code
changes to the client.&rdquo; This enables a very smooth Clojurescript
workflow. It&rsquo;s so seamless in fact that in some ways it makes
Clojurescript programming <em>more enjoyable</em> than working with Clojure!</p>

<p><a href="https://github.com/cemerick/piggieback#piggieback-">Piggieback</a> provides support for running a ClojureScript REPL
on top of an nREPL session. Chas goes into the reasons of why this is
a desirable thing in the README, so go check it out if you&rsquo;re interested.</p>

<p>Finally, <a href="https://github.com/tomjakubowski/weasel#weasel">Weasel</a> allows your ClojureScript REPL to use
WebSockets to communicate with your chosen execution environment.
Again, their README has good information about why this might be a
thing you want.</p>

<p>The next two sections are pretty much just setup for Piggieback and
Figwheel:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'>               <span class="ss">:repl-options</span> <span class="p">{</span><span class="ss">:init-ns</span> <span class="nv">tour.server</span>
</span><span class='line'>                              <span class="ss">:nrepl-middleware</span> <span class="p">[</span><span class="nv">cemerick.piggieback/wrap-cljs-repl</span><span class="p">]}</span>
</span><span class='line'>
</span><span class='line'>               <span class="ss">:plugins</span> <span class="p">[[</span><span class="nv">lein-figwheel</span> <span class="s">&quot;0.2.1-SNAPSHOT&quot;</span><span class="p">]]</span>
</span><span class='line'>
</span><span class='line'>               <span class="ss">:figwheel</span> <span class="p">{</span><span class="ss">:http-server-root</span> <span class="s">&quot;public&quot;</span>
</span><span class='line'>                          <span class="ss">:server-port</span> <span class="mi">3449</span>
</span><span class='line'>                          <span class="ss">:css-dirs</span> <span class="p">[</span><span class="s">&quot;resources/public/css&quot;</span><span class="p">]}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then both the dev and uberjar profiles contain an <code>:env</code> map
specifying either that <code>:is-dev</code> is <code>true</code> or <code>false</code>. These
configurations hook into the Environ library and allow you to specify
the value of environment variables directly in the project.clj
file. This particular usage should be pretty straightforward; it&rsquo;s
basically a simple switch that allows us to tell in our code whether
or not this is a dev build/run or not.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'>               <span class="ss">:env</span> <span class="p">{</span><span class="ss">:is-dev</span> <span class="nv">true</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The only thing remaining in the dev profile now is the cljsbuild test
configuration. Though once again, notice that there is the small
addition of the <code>env/dev/cljs</code> path as a source for our previosly
configured <code>app</code> ClojureScript build.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'>               <span class="ss">:cljsbuild</span> <span class="p">{</span><span class="ss">:test-commands</span> <span class="p">{</span> <span class="s">&quot;test&quot;</span> <span class="p">[</span><span class="s">&quot;phantomjs&quot;</span> <span class="s">&quot;env/test/js/unit-test.js&quot;</span> <span class="s">&quot;env/test/unit-test.html&quot;</span><span class="p">]</span> <span class="p">}</span>
</span><span class='line'>                           <span class="ss">:builds</span> <span class="p">{</span><span class="ss">:app</span> <span class="p">{</span><span class="ss">:source-paths</span> <span class="p">[</span><span class="s">&quot;env/dev/cljs&quot;</span><span class="p">]}</span>
</span><span class='line'>                                    <span class="ss">:test</span> <span class="p">{</span><span class="ss">:source-paths</span> <span class="p">[</span><span class="s">&quot;src/cljs&quot;</span> <span class="s">&quot;test/cljs&quot;</span><span class="p">]</span>
</span><span class='line'>                                           <span class="ss">:compiler</span> <span class="p">{</span><span class="ss">:output-to</span>     <span class="s">&quot;resources/public/js/app_test.js&quot;</span>
</span><span class='line'>                                                      <span class="ss">:output-dir</span>    <span class="s">&quot;resources/public/js/test&quot;</span>
</span><span class='line'>                                                      <span class="ss">:source-map</span>    <span class="s">&quot;resources/public/js/test.js.map&quot;</span>
</span><span class='line'>                                                      <span class="ss">:preamble</span>      <span class="p">[</span><span class="s">&quot;react/react.min.js&quot;</span><span class="p">]</span>
</span><span class='line'>                                                      <span class="ss">:optimizations</span> <span class="ss">:whitespace</span>
</span><span class='line'>                                                      <span class="ss">:pretty-print</span>  <span class="nv">false</span><span class="p">}}}}}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Compared to the <code>:dev</code> profile, the <code>:uberjar</code> is quite simple:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='clojure'><span class='line'>         <span class="ss">:uberjar</span> <span class="p">{</span><span class="ss">:source-paths</span> <span class="p">[</span><span class="s">&quot;env/prod/clj&quot;</span><span class="p">]</span>
</span><span class='line'>                   <span class="ss">:hooks</span> <span class="p">[</span><span class="nv">leiningen.cljsbuild</span><span class="p">]</span>
</span><span class='line'>                   <span class="ss">:env</span> <span class="p">{</span><span class="ss">:production</span> <span class="nv">true</span><span class="p">}</span>
</span><span class='line'>                   <span class="ss">:omit-source</span> <span class="nv">true</span>
</span><span class='line'>                   <span class="ss">:aot</span> <span class="ss">:all</span>
</span><span class='line'>                   <span class="ss">:cljsbuild</span> <span class="p">{</span><span class="ss">:builds</span> <span class="p">{</span><span class="ss">:app</span>
</span><span class='line'>                                        <span class="p">{</span><span class="ss">:source-paths</span> <span class="p">[</span><span class="s">&quot;env/prod/cljs&quot;</span><span class="p">]</span>
</span><span class='line'>                                         <span class="ss">:compiler</span>
</span><span class='line'>                                         <span class="p">{</span><span class="ss">:optimizations</span> <span class="ss">:advanced</span>
</span><span class='line'>                                          <span class="ss">:pretty-print</span> <span class="nv">false</span><span class="p">}}}}}})</span>
</span></code></pre></td></tr></table></div></figure>


<p>The main difference is the addition of three pieces of configuration
that make this a true production build. The <code>:hooks</code> option causes
leiningen to run the <code>leiningen.cljsbuild/activate</code> function to let it
<a href="https://github.com/technomancy/leiningen/blob/master/doc/PLUGINS.md#hooks">hook into the defualt Leiningen tasks</a>.</p>

<p>Then <code>:omit-source</code> simply directs leiningen not to include the
clojure source files in the resulting uberjar, and <code>:aot :all</code> causes
the Clojure compiler to <a href="http://clojure.org/compilation">Ahead-of-time compile</a> all your clojure
code. The idea behind both these configs is to make your final uberjar
as lean and performant as possible, at the expense of some (probably
not needed) flexibility.</p>

<p>So that&rsquo;s it for Chestnut&rsquo;s <code>project.clj</code>. It looks intimidating at
first, but in the end it is quite approachable when you break it down
into it&rsquo;s component pieces.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Geoff Shannon</span></span>

      




<time class='entry-date' datetime='2015-05-10T13:34:16-05:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>1:34 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/clojure/'>clojure</a>, <a class='category' href='/blog/categories/clojurescript/'>clojurescript</a>, <a class='category' href='/blog/categories/walkthrough/'>walkthrough</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://www.zephyrizing.net/blog/2015/05/10/chestnut-annotated/" data-via="RadicalZephyr" data-counturl="http://www.zephyrizing.net/blog/2015/05/10/chestnut-annotated/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/05/06/testing-and-the-structures-of-learning-environments/" title="Previous Post: Testing and the Structures of Learning Environments">&laquo; Testing and the Structures of Learning Environments</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/05/10/chestnut-annotated/">Chestnut - Annotated</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/06/testing-and-the-structures-of-learning-environments/">Testing and the Structures of Learning Environments</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/29/iteration-two-refactoring-and-minimax/">Iteration Two: Refactoring and Minimax</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/16/on-editors-and-their-benefits/">On Editors and Their Benefits</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/14/learning-tdd/">Learning TDD</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/RadicalZephyr">@RadicalZephyr</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'RadicalZephyr',
            count: 7,
            skip_forks: true,
            to_skip: ["radicalzephyr.github.io","home","prelude",".emacs.d","emacs","synapse-admin","old-site"],
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Geoff Shannon -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'zephyrizing';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://www.zephyrizing.net/blog/2015/05/10/chestnut-annotated/';
        var disqus_url = 'http://www.zephyrizing.net/blog/2015/05/10/chestnut-annotated/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>
<noscript>Please enable JavaScript to view
  the <a href="http://disqus.com/?ref_noscript">comments powered by
    Disqus.</a></noscript>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
